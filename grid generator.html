<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grid Text Overlay</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            background: #f0f0f0;
        }

        button {
            padding: 8px 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: #2980b9;
        }

        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
    </style>
</head>

<body>
    <canvas id="gridCanvas" width="3072" height="1408"></canvas>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const canvas = document.getElementById('gridCanvas')
            const ctx = canvas.getContext('2d')

            async function processImage() {

                try {
                    const response = await fetch('./questions.json')
                    const jsonData = await response.json()

                    const img = new Image()
                    img.onload = function () {
                        ctx.drawImage(img, 0, 0)
                        drawTextOnGrid(jsonData)
                        processed = true
                    }
                    img.src = './blank.png'
                } catch (error) {
                    console.error('Error processing image:', error)
                    processBtn.disabled = false
                }
            }

            function drawTextOnGrid(data) {
                const cellWidth = 256
                const cellHeight = 128
                const cols = 12

                ctx.fillStyle = '#ffffff'
                ctx.font = '20px sans-serif'
                ctx.textAlign = 'center'
                ctx.textBaseline = 'middle'

                for (let i = 0; i < data.length && i < 132; i++) {
                    const row = Math.floor(i / cols)
                    const col = i % cols

                    const x = col * cellWidth + cellWidth / 2
                    const y = row * cellHeight + cellHeight / 2

                    const maxWidth = cellWidth - 20
                    const words = data[i].text.split(' ')
                    let lines = []
                    let currentLine = words[0]

                    for (let j = 1; j < words.length; j++) {
                        const testLine = currentLine + ' ' + words[j]
                        const metrics = ctx.measureText(testLine)
                        if (metrics.width > maxWidth) {
                            lines.push(currentLine)
                            currentLine = words[j]
                        } else {
                            currentLine = testLine
                        }
                    }
                    lines.push(currentLine)

                    const lineHeight = 24
                    const startY = y - ((lines.length - 1) * lineHeight) / 2

                    for (let l = 0; l < lines.length; l++) {
                        ctx.fillText(lines[l], x, startY + l * lineHeight)
                    }
                }
            }
            processImage()
        })
    </script>
</body>

</html>